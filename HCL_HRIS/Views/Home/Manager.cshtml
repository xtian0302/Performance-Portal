@using System.Globalization;
@model IEnumerable<HCL_HRIS.Models.announcement>
@{
    ViewBag.Title = "Home Page";
}
<style>
    .fc-bgevent {
        color: white !important;
        font-weight: bolder;
        opacity: 1 !important;
    }

    .fc-title {
        font-weight: bold;
        text-align: center !important;
    }

    .fc-content {
        text-align: center;
    }
</style>
<div class="row ">
    <div class="col-md-6" style="min-height:1100px;padding:0px">
        <div class="card no-rad-brtr" style="min-height:1100px;padding:0px">
            <div class="card-header" style="padding:4.5px;">
                Manager Dashboard - @ViewBag.user.sub_department
            </div>
            <div class="card-body" style="padding:3px;">

                <div class="card" style="margin-top:5px;">
                    @*<div class="card-header" style="padding:3px;">
                            Productivity Score
                        </div>*@
                    <div class="card-body" style="padding:3px;font-size:0.75rem; overflow-x:auto;">
                        <table class="table-bordered table text-center" style="color:black;overflow-x:scroll;padding-bottom:0px;margin-bottom:0px;font-size:large;background-color:#93a9eb;color:ghostwhite;font-weight:bold;table-layout: fixed;">
                            <thead>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="4" style="padding:5px;background-color:#2a4796;color:whitesmoke;">As of @DateTime.Now.ToLongDateString() Performance</td>
                                </tr>
                                <tr>
                                    <td colspan="3">SCORE <br /> <h1 style="font-weight:bold;font-size:95px;margin-top:15px;"><a href="@Url.Action("Details")#minimize" style="text-decoration:none;color:whitesmoke;">@ViewBag.group_score</a></h1></td>
                                    <td>Rank <br /><br /> <h1 style="font-weight:bold;"><a href="#" style="text-decoration:none;color:whitesmoke;">@ViewBag.scoreRank</a> </h1> Of @ViewBag.total</td>
                                </tr>
                                <tr>
                                    <td><span style="font-style:oblique;">Track<br />Prod </span><br /> <h4 style="font-weight:bold;"><a href="@Url.Action("Details")#Prod" style="text-decoration:none;color:whitesmoke;">@ViewBag.group_prod</a></h4> @ViewBag.prodRank of @ViewBag.total</td>
                                    <td><span style="font-style:oblique;">Track<br />Quality </span><br /> <h4 style="font-weight:bold;"><a href="@Url.Action("Details")#Quality" style="text-decoration:none;color:whitesmoke;">@ViewBag.group_quality</a></h4> @ViewBag.qualityRank of @ViewBag.total</td>
                                    <td><span style="font-style:oblique;">Track<br />Behavior </span><br /> <h4 style="font-weight:bold;"> <a href="@Url.Action("Details")" style="text-decoration:none;color:whitesmoke;">@ViewBag.group_behavior</a></h4> @ViewBag.behaviorRank of @ViewBag.total</td>
                                    <td>
                                        <span style="font-style:oblique;">Track<br />Compliance </span><br /> <h4 style="font-weight:bold;">
                                            <a href="@Url.Action("Details")" style="text-decoration:none;color:whitesmoke;">
                                                @ViewBag.group_compliance
                                            </a>
                                        </h4>  @ViewBag.complianceRank of @ViewBag.total
                                    </td>
                                </tr>
                        </table>
                        @*For Team Leads*@
                        @*<table class="table-bordered table text-center" style="color:black;overflow-x:scroll;padding-bottom:0px;margin-bottom:0px;font-size:large;background-color:#93a9eb;color:ghostwhite;font-weight:bold;table-layout: fixed;">
        <tr>
            <td><span style="font-style:oblique;">Track Attrition</span><br /> <h4 style="font-weight:bold;"><a href="@Url.Action("Details")" style="text-decoration:none;color:whitesmoke;"></a></h4> @*3rd of 5*@</td>
                        @*<td><span style="font-style:oblique;">Attendance (self) </span><br /> <h4 style="font-weight:bold;"><a href="@Url.Action("Details")" style="text-decoration:none;color:whitesmoke;"></a></h4> @*3rd of 5*@</td>
                        @*<td><span style="font-style:oblique;">Compliance (self) </span><br /> <h4 style="font-weight:bold;"> <a href="@Url.Action("Details")" style="text-decoration:none;color:whitesmoke;"></a></h4> @*3rd of 5</td>
                        </tr>
                        </table>*@
                        <table class="table-bordered table text-center" style="color:black;overflow-x:scroll;padding-bottom:0px;margin-bottom:0px;font-size:large;background-color:#93a9eb;color:ghostwhite;font-weight:bold;table-layout: fixed;">
                            <tr>
                                <td style="font-weight:bolder;padding:6px;background-color:#2a4796;" colspan="2">MANAGER</td>
                                <td style="font-weight:bolder;padding:6px;background-color:#2a4796;" colspan="2">SUPPORT</td>
                            </tr>
                            <tr>
                                <td style="padding:6px;background-color:#4e73df;" colspan="2"><a href="mailto:@ViewBag.manager_mail" target="_top" style="color:whitesmoke;">@ViewBag.manager</a></td>
                                <td style="padding:6px;background-color:#4e73df;" colspan="2" rowspan="3"><a href="mailto:kimberley.pascual@hcl.com" target="_top" style="color:whitesmoke;">Kimberley Pascual (QA)</a> <br /><a href="mailto:donnajayne.salting@hcl.com" target="_top" style="color:whitesmoke;">Donna Salting (WF)</a> <br /><a href="mailto:marose.pachica@hcl.com" target="_top" style="color:whitesmoke;">Ma. Rose Pachica (Trainer)</a> <br /><a href="mailto:GianinaMaria.Ciriaco@hcl.com" target="_top" style="color:whitesmoke;">Gianina Ciriaco (HR)</a> <br /></td>
                            </tr>
                            <tr>
                                <td style="font-weight:bolder;padding:6px;background-color:#2a4796  ;" colspan="2">TEAM LEAD</td>
                            </tr>
                            <tr>
                                <td style="padding:6px;background-color:#4e73df;" colspan="2"><a href="mailto:@ViewBag.leader_mail" target="_top" style="color:whitesmoke;">@ViewBag.leader_name</a></td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="col-12 card no-rad-bltl" style="min-height:35%;padding:0px;border-top-right-radius: 0px !important;">
                    <div class="card-header" style="padding:4.5px;">
                        Chat
                    </div>
                    <div class="card-body" style="padding:3px;padding-bottom:10px;font-size:0.75rem;">
                        <ul class="nav nav-tabs" style=" ">
                            <li class="nav-item">
                                <a class="nav-link active " id="tl_click">Team Leader</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " id="team_click">Team Members</a>
                            </li>
                        </ul>
                        <!-- Chat Box -->
                        <div class="chatbox" id="chatbox">
                        </div>
                        <form onsubmit="return false">
                            <div class="input-group mb-3" style="border-top-left-radius:0px;border-top-right-radius:0px;margin-bottom:0px !important;">
                                <input type="text" id="chatMessage" required class="form-control" style="border-top-left-radius:0px;" placeholder="Enter Message..." aria-label="Enter Message..." aria-describedby="basic-addon2">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" id="tlSend" style="border-top-right-radius:0px;" type="submit">Send</button>
                                </div>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6" style="padding:0px">
        <div class="col-12 no-rad-bltl" style="min-height:30%;height:1px;border-bottom-right-radius: 0px !important;">
            <div class="row" style="min-height: 100%;">
                <div class="col-12 card no-rad-bltl" style="padding:0px;border-bottom-right-radius: 0px !important;border-top-right-radius: 0px !important;">
                    <div class="card-header" style="padding:4.5px;">
                        12 Month Track Trend
                    </div>
                    <div class="card-body" style="font-size:0.9rem;">
                        <canvas id="lineChart" width="600" height="300"></canvas>
                    </div>
                </div> 
            </div>
        </div>
        <div class="col-12 no-rad-bltl" style="min-height:30%;height:1px;border-bottom-right-radius: 0px !important;">
            <div class="row" style="min-height: 100%;">
                <div class="col-4 card no-rad-bltl" style="padding:0px;border-bottom-right-radius: 0px !important;border-top-right-radius: 0px !important;">
                    <div class="card-header" style="padding:4.5px;">
                        Announcements
                    </div>
                    <div class="card-body" style="font-size:0.9rem;">
                        @foreach (var item in Model)
                        {
                            <h5>@item.announcement_title</h5>
                            <p>@item.announcement_details</p>
                        }
                    </div>
                </div>
                <div class="col-4 card no-rad-bltl" style="padding:0px;border-bottom-right-radius: 0px !important;">
                    <div class="card-header" style="padding:4.5px;">
                        Track Top 5 Performers
                    </div>
                    <div class="card-body" style="padding:4.5px;font-size:0.75rem;">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item font-weight-bold">@ViewBag.top1sap - @ViewBag.top1name</li>
                            <li class="list-group-item">@ViewBag.top2sap - @ViewBag.top2name</li>
                            <li class="list-group-item">@ViewBag.top3sap - @ViewBag.top3name</li>
                            <li class="list-group-item">@ViewBag.top4sap - @ViewBag.top4name</li>
                            <li class="list-group-item">@ViewBag.top5sap - @ViewBag.top5name</li>
                        </ul>
                    </div>
                </div>
                <div class="col-4 card no-rad-bltl" style="padding:0px;border-bottom-right-radius: 0px !important;">
                    <div class="card-header" style="padding:4.5px;">
                        Track Performance
                    </div>
                    <div class="card-body" style="padding:4.5px;font-size:0.75rem;"> 
                        <canvas id="pieChart" width="400" height="500"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 card no-rad-bltl" style="min-height:40%;padding:0px;border-top-right-radius: 0px !important;">
            <div class="card-header" style="padding:4.5px;">
                Attendance and Pay Hours
            </div>
            <div class="card-body" style="padding:3px;font-size:0.75rem;text-align:center;">
                <span style="font-weight:bold;font-size:large">@DateTime.Now.ToString("MMMM", CultureInfo.CreateSpecificCulture("en"))</span>
                <a href="~/attendance/Index" class="btn btn-outline-dark float-right">See All...</a>
                <div id="calendar" style="width:75%;margin-left:25px;"></div>
            </div>
        </div>

    </div>
</div>
<script>
    var chatType = 'TL';
    $(document).ready(function () {
        var line = $('#lineChart');
        var data = {
            labels: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
            datasets: [
                {
                    label: "Real Day Data",
                    backgroundColor: 'rgba(54, 162, 235, 0.8)',
                    borderColor: 'rgba(54, 162, 235, 0.8)',
                    fill: false,
                    lineTension: 0,
                    data: [96.3, 97.4, 95.2, 98.2, 94.1, 96.3, 95.2, 94.3, 97.3, 93.3, 95.7, 98.1]
                },
                {
                    label: "Threshold",
                    backgroundColor: 'rgba(100, 100, 100, 0.8)',
                    borderColor: 'rgba(100, 100, 100, 0.8)',
                    fill: false,
                    data: [90.0, 90.0, 90.0, 90.0, 90.0, 90.0, 90.0, 90.0, 90.0, 90.0, 90.0, 90.0]
                }
            ]
        };

        var myLineChart = new Chart(line, {
            type: 'line',
            data: data,
            options: {
               scales: {
                    yAxes: [{
                        display: true,
                        ticks: {
                            suggestedMin: 85, 
                            stepSize:5
                        }
                    }]
                } 
            }
        });
        var pie = $('#pieChart'); 
        var myPieChart = new Chart(pie, {
            type: 'pie',
            data: {
                datasets: [{
                    data: [70, 30],
                    backgroundColor:
                        ['rgba(54, 162, 235, 0.8)','rgba(100, 100, 100, 0.8)']
                }],
            labels: [
                'Positive %',
                'Negative %' ]
            },
            options: {
                }
        });
        $('#clicky').click(function () {
            $('.hideable').toggle().animate();
            $(this).toggleClass('fa-window-minimize fa-window-maximize');
        });
        $('#clicky2').click(function () {
            $('.hideable2').toggle().animate();
            $(this).toggleClass('fa-window-minimize fa-window-maximize');
        });
        var uri = '../api/chats';
        reloadChat();

        $("#tlSend").click(function () {
            if ($("#chatMessage").val() == "") {
                return;
            }
            // Post New Chat
            if (chatType == 'TL') {
                var chat = {
                    chat_from: @ViewBag.user.user_id,
                    chat_message: $("#chatMessage").val(),
                    chat_to: @ViewBag.leader_sap,
                    datetime_read: null,
                    datetime_sent: null,
                };
                $.ajax({
                    type: "POST",
                    data: JSON.stringify(chat),
                    url: uri,
                    contentType: "application/json"
                }).done(function (res) {
                    clearChat();
                    console.log('res', res);
                    $("#chatMessage").val("")
                    $.getJSON(uri).done(function (data) {
                        $.each(data, function (key, item) {
                            // Add a list item for the product.
                            if (item.chat_from == @ViewBag.leader_sap) {
                                $("#chatbox").append('<span style="color:gray"><b> @ViewBag.leader_name : </b>' + item.chat_message + '</span><br />');
                            } else {
                                $("#chatbox").append('<span> @ViewBag.name : ' + item.chat_message + '</span><br />');
                            }
                        });
                        $("#chatbox").scrollTop(100000);
                    });
                    $("#chatMessage").focus();
                });
            } else if(chatType == 'Team')  {
                var chat = {
                    chat_from: @ViewBag.user.user_id,
                    chat_message: $("#chatMessage").val(),
                    chat_to: 0,
                    datetime_read: null,
                    datetime_sent: null,
                    group_id: @ViewBag.user.group_id
                };
                $.ajax({
                    type: "POST",
                    data: JSON.stringify(chat),
                    url: uri,
                    contentType: "application/json"
                }).done(function (res) {
                    clearChat();
                    console.log('res', res);
                    $("#chatMessage").val("")
                    reloadGroupChat();
                    $("#chatMessage").focus();
                });

            }
        });
    });

    $('#team_click').click(function () {
        chatType = 'Team';
        $(this).tab('show');
        clearChat();
        reloadGroupChat();
    });
    $('#tl_click').click(function () {
        chatType = 'TL';
        $(this).tab('show');
        clearChat();
        reloadChat();
    });
    //Attendance Calendar
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            plugins: [ 'dayGrid','bootstrap' ],
            themeSystem: 'bootstrap',
            eventOrder: 'eventProperty',
            fixedWeekCount: false,
            header: false,
            eventRender : function(info) {
                   const props = info.event.extendedProps,
                      rendering = info.event.rendering;
                   if(rendering == "background") {
		            $(info.el).text(info.event.title);
		            $(info.el).css({ "color": "#ffffff !important", "text-align": "center", "vertical-align": "middle" });
                 }
            }
        });

    //calendar.addEvent({
    //    title: 'A',
    //    start: '2020-01-02',
    //    allDay: true,
    //    backgroundColor: "Red",
    //    textColor: "white",
    //    rendering: 'background'
    //});
    //calendar.addEvent({
    //    title: '9.5 hrs',
    //    start: '2020-01-03',
    //    allDay: true,
    //    backgroundColor: "Green",
    //    textColor: "white",
    //    rendering: 'background'
    //});
    //     calendar.addEvent({
    //    title: '30 mins',
    //    start: '2020-01-06',
    //    allDay: true,
    //    backgroundColor: "Orange",
    //    textColor: "white",
    //    rendering: 'background'
    //});

        @foreach (var mins in ViewBag.minsCollection) {
        <text> 
  
          calendar.addEvent({
            title: '@string.Format("{0:0.#}",mins.minsLogged/60.0) hrs' ,
            start: '@mins.minsDate.ToString("yyyy-MM-dd")',
            allDay: true,
            backgroundColor: "Green",
            textColor: "white",
            rendering: 'background'
        });
        </text>
    }
    calendar.render();
    });

    // Utilities
    function clearChat(){
        $('#chatbox > span').remove();
        $('#chatbox > br').remove();
    }

    function reloadChat() {
        var uri = '../api/chats';
        $.getJSON(uri).done(function (data) {
            console.log(data);
            $.each(data, function (key, item) {
                // Add a list item for the product.
                if (item.chat_from == @ViewBag.leader_sap) {
                    $("#chatbox").append('<span style="color:gray"><b> @ViewBag.leader_name  : </b>' + item.chat_message + '</span><br />');
                } else {
                    $("#chatbox").append('<span> @ViewBag.name : ' + item.chat_message + '</span><br />');
                }
                $("#chatbox").scrollTop( 100000);
            });
        });
        }
    function reloadGroupChat() {
        var uri = '../api/chats/GetGroup';
        $.getJSON(uri).done(function (data) {
            console.log(data);
            $.each(data, function (key, item) {
                $("#chatbox").append('<span style="color:black"><b> ' + item.Name + '  : </b>' + item.chat_message + '</span><br />');
                $("#chatbox").scrollTop( 100000);
            });
        });
    }
</script>